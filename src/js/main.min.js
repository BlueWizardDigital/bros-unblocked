let allContent=null,allResults=[];const RESULTS_PER_PAGE=10,BASE_URL="/bros-unblocked/",DEBOUNCE_DELAY=300,BUILD_VERSION=document?.body?.dataset?.build;function debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}}function showError(e,t){if(!t)return;const n=document.createElement("div");n.className="error-message",n.style.cssText="\n    padding: 16px;\n    background: #fee;\n    border: 2px solid #fcc;\n    border-radius: 8px;\n    color: #c33;\n    margin: 20px 0;\n    text-align: center;\n    font-weight: 600;\n  ",n.textContent=e,t.innerHTML="",t.appendChild(n)}function showLoading(e){e&&(e.innerHTML='\n    <div class="loading-spinner" style="text-align: center; padding: 40px;">\n      <div style="font-size: 48px; animation: spin 1s linear infinite;">üéÆ</div>\n      <p style="color: #666; margin-top: 16px;">Loading games...</p>\n    </div>\n  ')}async function loadContent(){if(allContent)return!0;try{const e=await fetch(`${BASE_URL}content.json?v=${BUILD_VERSION}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);if(allContent=await e.json(),!allContent.games||!allContent.pages||!allContent.categories)throw new Error("Invalid content structure");return!0}catch(e){return console.error("Failed to load content:",e),allContent=null,!1}}function searchContent(e){if(!e.trim()||!allContent)return[];const t=e.toLowerCase(),n=[];return allContent.games&&Array.isArray(allContent.games)&&allContent.games.forEach(e=>{if(!e||!e.title)return;const a=(e.title.toLowerCase().includes(t)?10:0)+(e.description?.toLowerCase().includes(t)?5:0)+(e.tags?.some(e=>e.toLowerCase().includes(t))?3:0);a>0&&n.push({type:"game",score:a,...e})}),allContent.pages&&Array.isArray(allContent.pages)&&allContent.pages.forEach(e=>{if(!e||!e.title)return;const a=(e.title.toLowerCase().includes(t)?10:0)+(e.content?.toLowerCase().includes(t)?5:0);a>0&&n.push({type:"page",score:a,...e})}),allContent.categories&&Array.isArray(allContent.categories)&&allContent.categories.forEach(e=>{if(!e||!e.name)return;const a=(e.name.toLowerCase().includes(t)?10:0)+(e.description?.toLowerCase().includes(t)?5:0);a>0&&n.push({type:"category",score:a,...e})}),n.sort((e,t)=>t.score-e.score)}function formatResult(e){return`${{game:"üéÆ",page:"üìÑ",category:"üè∑Ô∏è"}[e.type]||"üìå"} ${e.title||e.name||"Untitled"}`}function getResultLink(e){if(!e||!e.slug)return"#";switch(e.type){case"game":return`${BASE_URL}games/${e.slug}/`;case"page":return`${BASE_URL}${e.slug}/`;case"category":return`${BASE_URL}category/${e.slug}/`;default:return"#"}}function getQueryParam(e){return new URLSearchParams(window.location.search).get(e)}const handleSearchInput=debounce(async(e,t)=>{if(!e.trim())return t.innerHTML="",void t.classList.remove("active");const n=searchContent(e).slice(0,5);if(0===n.length)return t.innerHTML='<div class="no-results">No results found üò¢</div>',void t.classList.add("active");const a=n.map(e=>`\n    <a href="${getResultLink(e)}" class="search-result search-result-${e.type}">\n      ${formatResult(e)}\n    </a>\n  `).join("");t.innerHTML=a,t.classList.add("active")},300);async function initHeaderSearch(){const e=document.getElementById("searchInput"),t=document.getElementById("searchDropdown");if(!e||!t)return;await loadContent()?(e.addEventListener("input",e=>{handleSearchInput(e.target.value,t)}),e.addEventListener("keydown",e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(window.location.href=`${BASE_URL}search/?q=${encodeURIComponent(t)}`)}}),document.addEventListener("click",e=>{e.target.closest(".search-container")||t.classList.remove("active")}),document.addEventListener("keydown",n=>{"Escape"===n.key&&(t.classList.remove("active"),e.blur())})):console.error("Failed to initialize search - content not loaded")}function renderResults(e=1){const t=Math.ceil(allResults.length/10),n=10*(e-1),a=allResults.slice(n,n+10),o=document.getElementById("searchResults");if(!o)return;if(0===a.length){o.innerHTML='\n      <div class="no-results">\n        <p style="font-size: 48px; margin-bottom: 16px;">üò¢</p>\n        <p>No results found. Try a different search term!</p>\n      </div>\n    ';const e=document.getElementById("pagination");return void(e&&(e.innerHTML=""))}const r=a.map(e=>`\n    <div class="search-result-card search-result-${e.type}">\n      <a href="${getResultLink(e)}">\n        <h3>${formatResult(e)}</h3>\n        <p>${e.description||e.content||"No description available"}</p>\n      </a>\n    </div>\n  `).join("");o.innerHTML=r,renderPagination(e,t),o.scrollIntoView({behavior:"smooth",block:"start"})}function renderPagination(e,t){const n=document.getElementById("pagination");if(!n)return;if(t<=1)return void(n.innerHTML="");let a="";e>1&&(a+=`<a href="#" data-page="${e-1}" class="pagination-btn">‚Üê Previous</a>`);for(let n=1;n<=t;n++)1===n||n===t||n>=e-2&&n<=e+2?a+=n===e?`<span class="current">${n}</span>`:`<a href="#" data-page="${n}" class="pagination-btn">${n}</a>`:n!==e-3&&n!==e+3||(a+="<span>...</span>");e<t&&(a+=`<a href="#" data-page="${e+1}" class="pagination-btn">Next ‚Üí</a>`),n.innerHTML=a,n.querySelectorAll(".pagination-btn").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=parseInt(e.target.dataset.page);isNaN(t)||renderResults(t)})})}async function initSearchPageResults(){const e=document.getElementById("searchResults"),t=document.getElementById("searchPageInput");if(!e)return;showLoading(e);if(!await loadContent())return void showError("Failed to load search content. Please try again later.",e);const n=getQueryParam("q");n?(t&&(t.value=n),allResults=searchContent(n),renderResults(1),document.title=`Search: "${n}" | Bros Unblocked`):e.innerHTML='\n      <div class="no-results">\n        <p style="font-size: 48px; margin-bottom: 16px;">üîç</p>\n        <p>Enter a search term to find games, pages, and categories!</p>\n      </div>\n    ',t&&t.addEventListener("keydown",e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim();t&&(window.location.href=`${BASE_URL}search/?q=${encodeURIComponent(t)}`)}})}function initMobileMenu(){const e=document.querySelector(".mobile-menu-toggle"),t=document.querySelector(".main-nav");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")}),document.addEventListener("click",n=>{n.target.closest(".header-main")||(t.classList.remove("active"),e.classList.remove("active"))}))}function initLazyLoading(){if("IntersectionObserver"in window){const e=new IntersectionObserver((e,t)=>{e.forEach(e=>{if(e.isIntersecting){const n=e.target;n.dataset.src&&(n.src=n.dataset.src,n.removeAttribute("data-src"),t.unobserve(n))}})});document.querySelectorAll("img[data-src]").forEach(t=>{e.observe(t)})}}function trackGamePlay(e){console.log(`Game played: ${e}`)}document.addEventListener("DOMContentLoaded",()=>{console.log("üéÆ Bros Unblocked - Initializing..."),initHeaderSearch(),document.getElementById("searchResults")&&initSearchPageResults(),initMobileMenu(),initLazyLoading(),console.log("‚úÖ Bros Unblocked - Ready!")}),window.addEventListener("error",e=>{console.error("Global error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason)});const style=document.createElement("style");style.textContent="\n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n",document.head.appendChild(style),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("contact-form"),t=document.getElementById("form-status"),n=e.querySelector(".submit-btn"),a=document.getElementById("issue-type"),o=document.getElementById("game-select-group"),r=document.getElementById("game");a.addEventListener("change",function(){"Game Bug Report"===this.value?(o.style.display="block",r.required=!0):(o.style.display="none",r.required=!1,r.value="")}),e.addEventListener("submit",async function(a){a.preventDefault(),n.disabled=!0,n.textContent="Sending...",t.style.display="none",t.className="";try{const n=new FormData(e);if(!(await fetch(e.action,{method:"POST",body:n,headers:{Accept:"application/json"}})).ok)throw new Error("Form submission failed");t.textContent="Thanks for your message! We'll get back to you soon.",t.className="success",e.reset(),o.style.display="none",r.required=!1}catch(e){t.textContent="Oops! Something went wrong. Please try again.",t.className="error"}finally{n.disabled=!1,n.textContent="Send Message",t.style.display="block"}})});